{"version":3,"file":"WindowLocationContext.js","sourceRoot":"","sources":["../../../src/rsc/router/WindowLocationContext.tsx"],"names":[],"mappings":"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","sourcesContent":["// Emulates the window.location object on native.\n\nimport { Linking, View, Platform } from 'react-native';\n\n// getInitialURL = () =>\n// ,\n// subscribe = (listener) => {\n// const callback = ({ url }: { url: string }) => listener(url);\n\n// const subscription = Linking.addEventListener('url', callback) as\n//   | { remove(): void }\n//   | undefined;\n\n// return () => {\n//   subscription?.remove();\n// };\n// },\n\nimport * as React from 'react';\nimport { getInitialURL, addEventListener } from '../../link/linking';\nimport { extractExpoPathFromURL } from '../../fork/extractPathFromURL';\n\nfunction useInitialLocation() {\n  const [initialUrl, setInitial] = React.useState(null);\n\n  React.useEffect(() => {\n    (async () => {\n      const v = await getInitialURL();\n\n      setInitial(v);\n    })();\n\n    return addEventListener((url) => {\n      setInitial(url);\n    });\n  }, []);\n\n  return initialUrl;\n}\n// window.history.pushState\n\nconst Location = React.createContext<{\n  // urlFragment: URL | null;\n  // window.history[method](window.history.state, '', url);\n  setHistory: (method: string, url: string | URL) => void;\n}>({ urlFragment: null, setHistory: () => {} });\n\nfunction coerceUrl(url: any) {\n  if (typeof url === 'object' && 'pathname' in url) {\n    return url as URL;\n  }\n  try {\n    return new URL(url);\n  } catch (e) {\n    return new URL(url, 'http://localhost:8081');\n  }\n}\nconst setUrl = (url: string) => {\n  console.log('Set URL:', url);\n  const v = coerceUrl(url);\n  globalThis.expoVirtualLocation = v;\n  // setInitial(v);\n};\n\n// setUrl('/');\n\n// (async () => {\n//   const v = await getInitialURL();\n\n//   setUrl(extractExpoPathFromURL(v));\n// })();\n\n// addEventListener((url) => {\n//   setUrl(extractExpoPathFromURL(url));\n// });\n\nexport function LocationContext({ children }: { children: React.ReactElement }) {\n  const [loaded, setLoaded] = React.useState(false);\n  // const [initialUrl, setInitial] = React.useState<URL | null>(null);\n  const [isPending, startTransition] = React.useTransition();\n\n  React.useEffect(() => {\n    (async () => {\n      const v = await getInitialURL();\n\n      setUrl(extractExpoPathFromURL(v));\n      // startTransition(() => {\n      setLoaded(true);\n      // });\n    })();\n\n    return addEventListener((url) => {\n      setUrl(extractExpoPathFromURL(url));\n    });\n  }, []);\n\n  if (!loaded) {\n    return null;\n  }\n\n  return (\n    <Location.Provider\n      value={{\n        // urlFragment: initialUrl,\n        setHistory(method, url) {\n          if (method === 'pushState') {\n            setUrl(url);\n          } else {\n            console.warn('Only pushState is supported atm');\n          }\n        },\n      }}>\n      {children}\n    </Location.Provider>\n  );\n}\n\nexport function useVirtualLocation() {\n  return React.useContext(Location);\n}\n"]}